[pytest]
# Configuration pytest pour éviter les doublons et optimiser les performances
# ⚠️ IMPORTANT: Toujours utiliser ./scripts/run_tests.sh au lieu de pytest directement
# pour éviter les problèmes de processus multiples et de consommation CPU excessive

# Répertoires de test
testpaths = tests

# Patterns de fichiers de test
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Options par défaut
addopts = 
    --strict-markers
    --strict-config
    --disable-warnings
    --tb=short
    -v
    --cov=arkalia_cia_python_backend
    --cov-report=term-missing
    --cov-report=html
    --cov-report=xml
    --cov-fail-under=15
    --maxfail=10
    --durations=10

# Marqueurs personnalisés
markers =
    slow: tests qui prennent plus de temps
    integration: tests d'intégration
    unit: tests unitaires
    security: tests de sécurité

# Protection contre les lancements multiples
# Note: pytest-timeout n'est pas installé par défaut
# Pour l'installer: pip install pytest-timeout
# Puis utiliser: pytest --timeout=300
# Le script run_tests.sh nettoie automatiquement les processus pytest avant de lancer

# Options de cache
cache_dir = .pytest_cache

# Options de logging
log_cli = false
log_cli_level = INFO

# Répertoires à ignorer lors de la collecte
norecursedirs = build dist .eggs *.egg arkalia_cia_venv .git __pycache__ .pytest_cache

# Configuration pour éviter les doublons
# Le script run_tests.sh nettoie automatiquement avant chaque exécution
# Si vous lancez pytest directement, vérifiez d'abord qu'aucun processus pytest ne tourne:
# pgrep -f pytest | wc -l  (doit retourner 0)
